From b50d031e1b76c7f2782f2673b93cc91c8e0e307a Mon Sep 17 00:00:00 2001
From: "Hongli Lai (Phusion)" <hongli@phusion.nl>
Date: Tue, 30 Sep 2014 15:16:26 +0200
Subject: [PATCH] Do not trap SIGKILL. Ruby 2.2 preview doesn't allow it

---
 lib/phusion_passenger/ruby_core_enhancements.rb | 15 ++++++++-------
 1 file changed, 8 insertions(+), 7 deletions(-)

diff --git a/lib/phusion_passenger/ruby_core_enhancements.rb b/lib/phusion_passenger/ruby_core_enhancements.rb
index 1f2924b..741bffe 100644
--- a/lib/phusion_passenger/ruby_core_enhancements.rb
+++ b/lib/phusion_passenger/ruby_core_enhancements.rb
@@ -1,6 +1,6 @@
 # encoding: binary
 #  Phusion Passenger - https://www.phusionpassenger.com/
-#  Copyright (c) 2010, 2011, 2012 Phusion
+#  Copyright (c) 2010-2014 Phusion
 #
 #  "Phusion Passenger" is a trademark of Hongli Lai & Ninh Bui.
 #
@@ -76,7 +76,7 @@ class IO
 		def writev(components)
 			return PhusionPassenger::NativeSupport.writev(fileno, components)
 		end
-		
+
 		# Like #writev, but accepts two arrays. The data is written in the given order.
 		#
 		#   io.writev2(["hello ", "world", "\n"], ["another ", "message\n"])
@@ -84,7 +84,7 @@ def writev2(components, components2)
 			return PhusionPassenger::NativeSupport.writev2(fileno,
 				components, components2)
 		end
-		
+
 		# Like #writev, but accepts three arrays. The data is written in the given order.
 		#
 		#   io.writev3(["hello ", "world", "\n"],
@@ -124,7 +124,7 @@ def writev3(components, components2, components3)
 			return write(data)
 		end
 	end
-	
+
 	if IO.method_defined?(:close_on_exec=)
 		def close_on_exec!
 			self.close_on_exec = true
@@ -163,16 +163,17 @@ def self.list_trappable
 			result.delete("ALRM")
 			result.delete("VTALRM")
 		end
-		
+
 		# Don't touch SIGCHLD no matter what! On OS X waitpid() will
 		# malfunction if SIGCHLD doesn't have a correct handler.
 		result.delete("CLD")
 		result.delete("CHLD")
-		
+
 		# Other stuff that we don't want to trap no matter which
 		# Ruby engine.
 		result.delete("STOP")
-		
+		result.delete("KILL")
+
 		return result
 	end
 end
-- 
2.4.3

